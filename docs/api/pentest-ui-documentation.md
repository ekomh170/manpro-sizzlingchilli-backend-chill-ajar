# Pentest UI Documentation - Chill Ajar Backend

## üìã Daftar Isi
- [Overview](#overview)
- [Akses Pentest UI](#akses-pentest-ui)
- [Daftar Controller yang Tersedia](#daftar-controller-yang-tersedia)
- [Detail Endpoint per Controller](#detail-endpoint-per-controller)
- [Testing Workflow](#testing-workflow)
- [Tips & Best Practices](#tips--best-practices)

---

## Overview

**Pentest UI** adalah antarmuka web interaktif untuk menguji semua endpoint API backend Chill Ajar tanpa perlu tools eksternal seperti Postman. Setiap controller memiliki halaman testing sendiri dengan contoh request body yang sudah disiapkan.

**Teknologi:**
- Laravel Blade Templates
- Tailwind CSS
- JavaScript (Fetch API)
- GuzzleHTTP untuk WhatsApp Gateway

---

## Akses Pentest UI

### Base URL
```
http://your-domain.com/pentest
```

### Halaman Utama
```
GET /pentest
```

Halaman ini menampilkan daftar semua controller yang tersedia untuk testing.

---

## Daftar Controller yang Tersedia

### 1. **Auth Controller**
**URL:** `/pentest/auth`

**Endpoints:**
- `POST /api/login` - Login user
- `POST /api/register` - Registrasi user baru
- `POST /api/logout` - Logout (requires auth)
- `PUT /api/user/profil` - Update profil user
- `POST /api/user/upload-foto` - Upload foto profil

---

### 2. **Admin Controller**
**URL:** `/pentest/admin`

**Endpoints:**
- `GET /api/admin/users` - Daftar semua user
- `PUT /api/admin/users/{userId}/role` - Ubah role user
- `POST /api/admin/users` - Tambah user baru
- `DELETE /api/admin/users/{userId}` - Hapus user
- `POST /api/admin/mentor` - Tambah mentor
- `PUT /api/admin/mentor/{id}` - Update mentor
- `DELETE /api/admin/mentor/{id}` - Hapus mentor
- `POST /api/admin/pelanggan` - Tambah pelanggan
- `PUT /api/admin/pelanggan/{id}` - Update pelanggan
- `DELETE /api/admin/pelanggan/{id}` - Hapus pelanggan
- `POST /api/admin/verifikasi-pembayaran/{transaksiId}` - Verifikasi pembayaran
- `POST /api/admin/tolak-pembayaran/{transaksiId}` - Tolak pembayaran
- `GET /api/admin/dashboard-info` - Statistik dashboard

---

### 3. **Mentor Controller**
**URL:** `/pentest/mentor`

**Endpoints:**
- `GET /api/mentor/profil-saya` - Profil mentor login
- `POST /api/mentor/kursus` - Tambah kursus sendiri
- `PUT /api/mentor/kursus/{id}` - Update kursus sendiri
- `POST /api/mentor/atur-jadwal` - Atur jadwal pengajaran
- `POST /api/mentor/atur-gaya` - Atur gaya mengajar
- `GET /api/mentor/daftar-kursus` - Daftar kursus yang diampu
- `GET /api/mentor/daftar-sesi` - Daftar sesi yang diampu (include paket.items)
- `POST /api/mentor/mulai-sesi/{sessionId}` - Mulai sesi
- `POST /api/mentor/selesai-sesi/{sessionId}` - Selesaikan sesi
- `GET /api/mentor/daftar-testimoni` - Daftar testimoni diterima
- `GET /api/mentor/dashboard-info` - Dashboard analytics & calendar

---

### 4. **Pelanggan Controller**
**URL:** `/pentest/pelanggan`

**Endpoints:**
- `GET /api/pelanggan/profil-saya` - Profil pelanggan login
- `GET /api/pelanggan/daftar-kursus` - Daftar kursus tersedia (dengan paket)
- `GET /api/pelanggan/cari-mentor` - Cari mentor berdasarkan kursus
- `GET /api/pelanggan/detail-mentor/{mentorId}` - Detail mentor
- `POST /api/pelanggan/pesan-sesi` - Pesan sesi (dengan/tanpa paket)
- `GET /api/pelanggan/daftar-sesi` - Daftar sesi (transaksi accepted, include paket.items)
- `GET /api/pelanggan/daftar-sesi-transaksi` - Daftar sesi untuk transaksi (semua status)
- `POST /api/pelanggan/unggah-bukti/{transaksiId}` - Unggah bukti pembayaran
- `POST /api/pelanggan/beri-testimoni/{sessionId}` - Beri testimoni
- `GET /api/pelanggan/profil-info` - Statistik pelanggan

**‚≠ê Fitur Paket pada Pesan Sesi:**
```json
{
  "mentor_id": 1,
  "pelanggan_id": 2,
  "kursus_id": 3,
  "jadwal_kursus_id": 5,
  "paket_id": 2,  // OPTIONAL: null jika tanpa paket
  "detailKursus": "Fokus turunan",
  "statusSesi": "pending"
}
```

---

### 5. **Kursus Controller**
**URL:** `/pentest/kursus`

**Endpoints:**
- `GET /api/kursus` - Daftar kursus (include visibilitasPaket.paket.items)
- `POST /api/kursus` - Tambah kursus baru
- `GET /api/kursus/{id}` - Detail kursus
- `PUT /api/kursus/{id}` - Update kursus
- `DELETE /api/kursus/{id}` - Hapus kursus

**‚≠ê Contoh Request Body (Create/Update):**
```json
{
  "namaKursus": "Kalkulus Dasar",
  "deskripsi": "Belajar kalkulus dari dasar",
  "mentor_id": 1,
  "fotoKursus": "[file upload]",
  "paket_ids": [1, 2, 3],  // Wajib minimal 1 paket
  "visibilitas_paket": [
    {"paket_id": 1, "visibilitas": true},
    {"paket_id": 2, "visibilitas": false}
  ]
}
```

---

### 6. **Sesi Controller**
**URL:** `/pentest/sesi`

**Endpoints:**
- `GET /api/sesi` - Daftar sesi (transaksi accepted, include paket)
- `POST /api/sesi` - Tambah sesi
- `GET /api/sesi/{id}` - Detail sesi (include paket, transaksi, testimoni)
- `PUT /api/sesi/{id}` - Update sesi
- `DELETE /api/sesi/{id}` - Hapus sesi
- `POST /api/sesi/{id}/konfirmasi` - Konfirmasi sesi dimulai (kirim WA ke pelanggan)
- `POST /api/sesi/{id}/selesai` - Tandai sesi selesai

**‚≠ê Response include Paket:**
```json
{
  "id": 1,
  "paket_id": 2,
  "jumlahSementara": 150000,
  "paket": {
    "id": 2,
    "nama": "Paket Premium",
    "harga_dasar": 100000,
    "diskon": 10000,
    "items": [...]
  }
}
```

---

### 7. **Transaksi Controller**
**URL:** `/pentest/transaksi`

**Endpoints:**
- `GET /api/transaksi` - Daftar transaksi
- `POST /api/transaksi` - Tambah transaksi
- `GET /api/transaksi/{id}` - Detail transaksi
- `PUT /api/transaksi/{id}` - Update transaksi
- `DELETE /api/transaksi/{id}` - Hapus transaksi
- `POST /api/transaksi/{id}/unggah-bukti` - Unggah bukti pembayaran
- `POST /api/transaksi/{id}/verifikasi` - Verifikasi pembayaran
- `POST /api/transaksi/{id}/tolak` - Tolak pembayaran

---

### 8. **Testimoni Controller**
**URL:** `/pentest/testimoni`

**Endpoints:**
- `GET /api/testimoni` - Daftar testimoni
- `POST /api/testimoni` - Tambah testimoni
- `GET /api/testimoni/{id}` - Detail testimoni
- `PUT /api/testimoni/{id}` - Update testimoni
- `DELETE /api/testimoni/{id}` - Hapus testimoni
- `GET /api/mentor/{mentorId}/testimoni` - Testimoni mentor tertentu

---

### 9. **Paket Controller** ‚≠ê NEW
**URL:** `/pentest/paket`

**Endpoints:**
- `GET /api/paket` - Daftar paket (include items)
- `POST /api/paket` - Tambah paket
- `GET /api/paket/{id}` - Detail paket
- `PUT /api/paket/{id}` - Update paket
- `DELETE /api/paket/{id}` - Hapus paket (soft delete)

**‚≠ê Contoh Request Body:**
```json
{
  "nama": "Paket Premium",
  "harga_dasar": 100000,
  "diskon": 10000,
  "deskripsi": "Paket pembelajaran premium",
  "max_pembelian_per_user": 5,
  "tanggal_mulai": "2025-01-01",
  "tanggal_berakhir": "2025-12-31",
  "items": [
    {"id": 1, "jumlah_item": 2},
    {"id": 2, "jumlah_item": 1}
  ]
}
```

**‚≠ê Catatan Penting:**
- Field `diskon` adalah nominal diskon (bukan persentase)
- `harga_dasar` akan **auto-recalculate** jika item berubah
- Soft delete: paket dihapus tetap ada di database

---

### 10. **Item Paket Controller** ‚≠ê NEW
**URL:** `/pentest/itempaket`

**Endpoints:**
- `GET /api/item-paket` - Daftar item paket
- `POST /api/item-paket` - Tambah item paket
- `GET /api/item-paket/{id}` - Detail item paket
- `PUT /api/item-paket/{id}` - Update item paket
- `DELETE /api/item-paket/{id}` - Hapus item paket (soft delete)

**‚≠ê Contoh Request Body:**
```json
{
  "nama": "Modul PDF Premium",
  "harga": 50000,
  "diskon": 5000,
  "deskripsi": "Modul lengkap dengan video tutorial"
}
```

**‚≠ê Auto-Recalculation:**
- Saat item diupdate (harga/diskon) ‚Üí sistem auto-recalculate `harga_dasar` semua paket terkait
- Saat item dihapus ‚Üí sistem auto-recalculate `harga_dasar` semua paket terkait
- Item yang di-soft delete tidak dihitung dalam kalkulasi

---

### 11. **WhatsApp Testing** ‚≠ê BONUS
**URL:** `/pentest/wa`

**Fitur:**
- Test kirim WhatsApp notification
- Normalisasi nomor otomatis (08xxx ‚Üí 628xxx)
- Integrasi dengan WA Gateway

**Form Fields:**
- `nomor`: Nomor WhatsApp tujuan
- `pesan`: Pesan yang akan dikirim

---

## Detail Endpoint per Controller

### Paket Controller - Detail Endpoints

#### 1. GET /api/paket
**Deskripsi:** Ambil semua data paket beserta relasi item

**Response:**
```json
[
  {
    "id": 1,
    "nama": "Paket Basic",
    "harga_dasar": 50000,
    "diskon": 5000,
    "deskripsi": "Paket pembelajaran dasar",
    "tanggal_mulai": "2025-01-01",
    "tanggal_berakhir": "2025-12-31",
    "max_pembelian_per_user": 3,
    "items": [
      {
        "id": 1,
        "nama": "Modul PDF",
        "harga": 20000,
        "diskon": 2000,
        "deskripsi": "Modul format PDF",
        "pivot": {
          "jumlah_item": 2
        }
      }
    ]
  }
]
```

#### 2. POST /api/paket
**Deskripsi:** Tambah paket baru beserta relasi item

**Request Body:**
```json
{
  "nama": "Paket Premium",
  "harga_dasar": 100000,
  "diskon": 10000,
  "deskripsi": "Paket pembelajaran premium",
  "max_pembelian_per_user": 5,
  "tanggal_mulai": "2025-01-01",
  "tanggal_berakhir": "2025-12-31",
  "items": [
    {"id": 1, "jumlah_item": 2},
    {"id": 2, "jumlah_item": 1}
  ]
}
```

**Response:** Data paket yang baru dibuat + relasi items

#### 3. PUT /api/paket/{id}
**Deskripsi:** Update data paket dan relasi item

**Catatan:**
- Hanya field yang dikirim yang akan diupdate
- Relasi items akan di-sync ulang jika `items` array dikirim

#### 4. DELETE /api/paket/{id}
**Deskripsi:** Soft delete paket

**Response:**
```json
{
  "message": "Paket berhasil dihapus"
}
```

---

### Item Paket Controller - Detail Endpoints

#### 1. GET /api/item-paket
**Deskripsi:** Ambil semua data item paket

**Response:**
```json
[
  {
    "id": 1,
    "nama": "Modul PDF",
    "harga": 20000,
    "diskon": 2000,
    "deskripsi": "Modul pembelajaran format PDF",
    "created_at": "2025-08-20T10:00:00.000000Z",
    "updated_at": "2025-08-20T10:00:00.000000Z"
  }
]
```

#### 2. POST /api/item-paket
**Deskripsi:** Tambah item paket baru

**Request Body:**
```json
{
  "nama": "Video Tutorial",
  "harga": 50000,
  "diskon": 5000,
  "deskripsi": "Video tutorial lengkap"
}
```

**Validasi:**
- `nama`: required, string, max 100
- `harga`: required, integer
- `diskon`: nullable, integer
- `deskripsi`: nullable, string

#### 3. PUT /api/item-paket/{id}
**Deskripsi:** Update data item paket

**‚ö†Ô∏è PENTING - Auto-Recalculation:**
```
Jika harga atau diskon berubah:
1. Sistem deteksi perubahan via wasChanged(['harga', 'diskon'])
2. Ambil semua paket yang menggunakan item ini
3. Recalculate harga_dasar untuk setiap paket
4. Save paket dengan harga_dasar baru

Formula:
harga_dasar = sum(max(item.harga - item.diskon, 0) * jumlah_item)
```

**Request Body:**
```json
{
  "nama": "Modul PDF Update",
  "harga": 25000,
  "diskon": 3000
}
```

#### 4. DELETE /api/item-paket/{id}
**Deskripsi:** Soft delete item paket

**‚ö†Ô∏è PENTING - Auto-Recalculation:**
```
Saat item dihapus (soft delete):
1. Ambil semua paket yang punya item ini
2. Soft delete item
3. Recalculate harga_dasar paket (exclude item yang dihapus)
4. Save paket dengan harga_dasar baru
```

---

## Testing Workflow

### Workflow 1: Testing Sistem Paket

**Langkah-langkah:**

1. **Buat Item Paket**
   ```
   POST /api/item-paket
   {
     "nama": "Modul PDF",
     "harga": 20000,
     "diskon": 2000
   }
   ```

2. **Buat Paket dengan Items**
   ```
   POST /api/paket
   {
     "nama": "Paket Basic",
     "harga_dasar": 0,  // akan auto-calculate
     "diskon": 5000,
     "items": [
       {"id": 1, "jumlah_item": 2}
     ]
   }
   ```

3. **Update Harga Item** (Test Auto-Recalculation)
   ```
   PUT /api/item-paket/1
   {
     "harga": 25000
   }
   ```

4. **Cek Paket** (harga_dasar harus berubah otomatis)
   ```
   GET /api/paket/1
   ```

5. **Buat Kursus dengan Paket**
   ```
   POST /api/kursus
   {
     "namaKursus": "Kalkulus",
     "mentor_id": 1,
     "paket_ids": [1]
   }
   ```

6. **Pesan Sesi dengan Paket**
   ```
   POST /api/pelanggan/pesan-sesi
   {
     "kursus_id": 1,
     "paket_id": 1,
     ...
   }
   ```

7. **Cek Sesi** (jumlahSementara = paket + biaya mentor)
   ```
   GET /api/sesi/1
   ```

---

### Workflow 2: Testing Filter Transaksi

**Langkah-langkah:**

1. **Pesan Sesi** (statusSesi: pending)
2. **Upload Bukti Pembayaran** (statusPembayaran: menunggu_verifikasi)
3. **Verifikasi Pembayaran** (statusPembayaran: accepted)
4. **Cek Daftar Sesi Pelanggan**
   ```
   GET /api/pelanggan/daftar-sesi
   // Hanya tampil sesi dengan transaksi accepted
   ```

5. **Cek Riwayat Transaksi**
   ```
   GET /api/pelanggan/daftar-sesi-transaksi
   // Tampil semua sesi (termasuk yang belum dibayar)
   ```

---

### Workflow 3: Testing Visibilitas Paket

**Langkah-langkah:**

1. **Buat Kursus dengan 1 Paket**
   ```
   POST /api/kursus
   {
     "paket_ids": [1]
   }
   ```

2. **Edit Kursus - Tambah Paket Lain**
   ```
   PUT /api/kursus/1
   {
     "visibilitas_paket": [
       {"paket_id": 1, "visibilitas": true},
       {"paket_id": 2, "visibilitas": true},
       {"paket_id": 3, "visibilitas": false}
     ]
   }
   ```

3. **Cek Kursus** (harus punya 3 paket dengan status berbeda)
   ```
   GET /api/kursus/1
   ```

---

## Tips & Best Practices

### 1. **Authentication Testing**
```javascript
// Simpan token setelah login
localStorage.setItem('token', response.token);

// Gunakan token di request berikutnya
fetch('/api/endpoint', {
  headers: {
    'Authorization': 'Bearer ' + localStorage.getItem('token')
  }
});
```

### 2. **Testing Auto-Recalculation**
- Selalu cek `harga_dasar` paket setelah update item
- Bandingkan manual calculation dengan hasil sistem
- Test dengan multiple paket yang punya item sama

### 3. **Testing Soft Delete**
- Setelah delete item, cek paket masih ada di database
- Pastikan item yang dihapus tidak muncul di relasi
- Cek kalkulasi harga tidak include item yang dihapus

### 4. **Testing Filter Status**
- Test endpoint `daftarSesi` vs `daftarSesiTransaksi`
- Pastikan filter `statusPembayaran = accepted` berfungsi
- Cek sesi dengan berbagai status transaksi

### 5. **Testing File Upload**
- Gunakan FormData untuk upload foto/bukti
- Max file size: 10MB
- Format allowed: jpg, jpeg, png, pdf (untuk bukti)

### 6. **Testing WhatsApp Notification**
- Pastikan nomor format 628xxx
- Test dengan nomor yang berbeda
- Cek log jika gagal kirim

---

## Error Handling

### Common Errors

**1. 401 Unauthorized**
```json
{
  "message": "Unauthenticated."
}
```
**Solution:** Login dulu, simpan token, gunakan di header

**2. 422 Validation Error**
```json
{
  "message": "The given data was invalid.",
  "errors": {
    "paket_ids": ["The paket ids field is required."]
  }
}
```
**Solution:** Cek field yang required, perbaiki request body

**3. 404 Not Found**
```json
{
  "message": "No query results for model [App\\Models\\Paket] 999"
}
```
**Solution:** Pastikan ID yang digunakan ada di database

**4. 500 Server Error**
**Solution:** Cek log di `/debug-log`, fix code error

---

## Automation Endpoints

### 1. Hapus Sesi Expired
```
POST /api/pentest/exec-hapus-sesi-expired
```
Menjalankan command `sesi:hapus-expired`

### 2. Update Rating Mentor
```
POST /api/pentest/exec-update-rating-mentor
```
Menjalankan command `mentor:update-rating`

---

## Debugging

### Debug Log
```
GET /debug-log
```
Tampilkan isi file `storage/logs/laravel.log`

### CORS Check
```
GET /api/cors-check
```
Tampilkan konfigurasi CORS

### ENV Check
```
GET /cek-env
```
Tampilkan konfigurasi environment variable

---

## Update History

### Version 1.2.0 (October 15, 2025)
- ‚úÖ Tambah Pentest UI untuk **Paket Controller**
- ‚úÖ Tambah Pentest UI untuk **Item Paket Controller**
- ‚úÖ Support testing auto-recalculation harga paket
- ‚úÖ Support testing visibilitas paket per kursus
- ‚úÖ Support testing filter transaksi accepted
- ‚úÖ Dokumentasi lengkap workflow testing

---

**Last Updated:** October 15, 2025  
**Version:** 1.2.0  
**Maintained by:** SizzlingChilli Team

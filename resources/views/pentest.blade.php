<!-- resources/views/pentest.blade.php -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pentest API Playground</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
            background: #f7f7f7;
        }

        .container {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            max-width: 700px;
            margin: auto;
            box-shadow: 0 2px 8px #0001;
        }

        input,
        select,
        textarea {
            width: 100%;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        label {
            font-weight: bold;
        }

        .response {
            background: #222;
            color: #0f0;
            padding: 1rem;
            border-radius: 4px;
            white-space: pre-wrap;
            margin-top: 1rem;
        }

        .flex {
            display: flex;
            gap: 1rem;
        }

        .flex>* {
            flex: 1;
        }

        button {
            padding: 0.7rem 2rem;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>Pentest API Playground</h2>
        <p style="color:#555;margin-bottom:1.5rem;">Pilih endpoint API dari daftar, atau isi manual. Untuk endpoint yang
            butuh autentikasi, masukkan token pada kolom Headers.<br>Contoh: <code>{"Authorization": "Bearer
                &lt;token&gt;"}</code>
        </p>
        <div class="flex" style="margin-bottom:1.5rem;align-items:flex-end;gap:1rem;">
            <div style="flex:2;">
                <label for="preset">Pilih Endpoint API</label>
                <select id="preset" onchange="setPreset()">
                    <option value="">-- Pilih endpoint --</option>
                    <optgroup label="Auth">
                        <option value='{"method":"POST","url":"/api/login","body":{"email":"","password":""}}'>[POST]
                            /api/login</option>
                        <option
                            value='{"method":"POST","url":"/api/register","body":{"name":"","email":"","password":""}}'>
                            [POST] /api/register</option>
                    </optgroup>
                    <optgroup label="Mentor">
                        <option value='{"method":"GET","url":"/api/mentor/daftar-sesi"}'>[GET] /api/mentor/daftar-sesi
                        </option>
                        <option value='{"method":"GET","url":"/api/mentor/profil-saya"}'>[GET] /api/mentor/profil-saya
                        </option>
                        <option value='{"method":"GET","url":"/api/mentor/daftar-kursus"}'>[GET]
                            /api/mentor/daftar-kursus</option>
                        <option value='{"method":"GET","url":"/api/mentor/daftar-testimoni"}'>[GET]
                            /api/mentor/daftar-testimoni</option>
                    </optgroup>
                    <optgroup label="Pelanggan">
                        <option value='{"method":"GET","url":"/api/pelanggan/profil-saya"}'>[GET]
                            /api/pelanggan/profil-saya</option>
                        <option value='{"method":"GET","url":"/api/pelanggan/daftar-kursus"}'>[GET]
                            /api/pelanggan/daftar-kursus</option>
                        <option value='{"method":"GET","url":"/api/pelanggan/cari-mentor?namaKursus="}'>[GET]
                            /api/pelanggan/cari-mentor</option>
                        <option value='{"method":"GET","url":"/api/pelanggan/daftar-sesi"}'>[GET]
                            /api/pelanggan/daftar-sesi</option>
                    </optgroup>
                    <optgroup label="Kursus">
                        <option value='{"method":"GET","url":"/api/kursus"}'>[GET] /api/kursus</option>
                        <option value='{"method":"GET","url":"/api/jadwal-kursus"}'>[GET] /api/jadwal-kursus</option>
                    </optgroup>
                    <optgroup label="Sesi">
                        <option value='{"method":"GET","url":"/api/sesi"}'>[GET] /api/sesi</option>
                    </optgroup>
                    <optgroup label="Transaksi">
                        <option value='{"method":"GET","url":"/api/transaksi"}'>[GET] /api/transaksi</option>
                    </optgroup>
                    <optgroup label="Testimoni">
                        <option value='{"method":"GET","url":"/api/testimoni"}'>[GET] /api/testimoni</option>
                    </optgroup>
                </select>
            </div>
            <div style="flex:1;text-align:right;">
                <button type="button" onclick="resetForm()" style="background:#888;">Reset Form</button>
                <button type="button" onclick="loadApiList()" style="background:#28a745;">Reload API List</button>
            </div>
        </div>
        <form id="apiForm" onsubmit="return false;">
            <div class="flex">
                <div>
                    <label for="method">Method</label>
                    <select id="method">
                        <option>GET</option>
                        <option>POST</option>
                        <option>PUT</option>
                        <option>DELETE</option>
                    </select>
                </div>
                <div style="flex:2;">
                    <label for="url">Endpoint URL</label>
                    <input id="url" type="text" placeholder="/api/endpoint">
                </div>
            </div>
            <label for="headers">Headers (JSON)</label>
            <textarea id="headers" rows="2" placeholder='{"Authorization": "Bearer ..."}'></textarea>
            <label for="body">Body (JSON, untuk POST/PUT)</label>
            <textarea id="body" rows="4" placeholder='{"key": "value"}'></textarea>
            <button type="submit" onclick="sendRequest()">Send</button>
        </form>
        <div id="response" class="response" style="display:none;"></div>
    </div>
    <script>
        // Daftar endpoint API, bisa di-extend otomatis dari file JSON atau array JS
        let apiList = [{
                method: 'POST',
                url: '/api/login',
                body: {
                    email: '',
                    password: ''
                }
            },
            {
                method: 'POST',
                url: '/api/register',
                body: {
                    name: '',
                    email: '',
                    password: ''
                }
            },
            {
                method: 'GET',
                url: '/api/mentor/daftar-sesi'
            },
            {
                method: 'GET',
                url: '/api/mentor/profil-saya'
            },
            {
                method: 'GET',
                url: '/api/mentor/daftar-kursus'
            },
            {
                method: 'GET',
                url: '/api/mentor/daftar-testimoni'
            },
            {
                method: 'GET',
                url: '/api/pelanggan/profil-saya'
            },
            {
                method: 'GET',
                url: '/api/pelanggan/daftar-kursus'
            },
            {
                method: 'GET',
                url: '/api/pelanggan/cari-mentor?namaKursus='
            },
            {
                method: 'GET',
                url: '/api/pelanggan/daftar-sesi'
            },
            {
                method: 'GET',
                url: '/api/kursus'
            },
            {
                method: 'GET',
                url: '/api/sesi'
            },
            {
                method: 'GET',
                url: '/api/transaksi'
            },
            {
                method: 'GET',
                url: '/api/testimoni'
            },
            {
                method: 'GET',
                url: '/api/jadwal-kursus'
            },
            // Tambahkan endpoint lain sesuai kebutuhan
        ];

        function loadApiList() {
            // Bisa di-extend: fetch('/docs-api/all.json').then(...)
            const preset = document.getElementById('preset');
            preset.innerHTML = '<option value="">-- Pilih endpoint --</option>';
            apiList.forEach(api => {
                let label = `[${api.method}] ${api.url}`;
                let value = JSON.stringify(api);
                let opt = document.createElement('option');
                opt.value = value;
                opt.textContent = label;
                preset.appendChild(opt);
            });
        }
        loadApiList();

        function setPreset() {
            const preset = document.getElementById('preset').value;
            if (!preset) return;
            let data = JSON.parse(preset);
            document.getElementById('method').value = data.method || 'GET';
            document.getElementById('url').value = data.url || '';
            document.getElementById('body').value = data.body ? JSON.stringify(data.body, null, 2) : '';
        }

        function resetForm() {
            document.getElementById('preset').value = '';
            document.getElementById('method').value = 'GET';
            document.getElementById('url').value = '';
            document.getElementById('headers').value = '';
            document.getElementById('body').value = '';
            document.getElementById('response').style.display = 'none';
        }

        function sendRequest() {
            const method = document.getElementById('method').value;
            let url = document.getElementById('url').value;
            if (!url.startsWith('http')) {
                url = window.location.origin + url;
            }
            let headers = {};
            try {
                headers = JSON.parse(document.getElementById('headers').value || '{}');
            } catch (e) {
                alert('Headers harus format JSON!');
                return;
            }
            let body = document.getElementById('body').value;
            let options = {
                method,
                headers
            };
            if (['POST', 'PUT'].includes(method)) {
                try {
                    body = body ? JSON.stringify(JSON.parse(body)) : '';
                } catch (e) {
                    alert('Body harus format JSON!');
                    return;
                }
                options.body = body;
                if (!headers['Content-Type']) options.headers['Content-Type'] = 'application/json';
            }
            document.getElementById('response').style.display = 'block';
            document.getElementById('response').textContent = 'Loading...';
            fetch(url, options)
                .then(async res => {
                    let text = await res.text();
                    let pretty = '';
                    try {
                        pretty = JSON.stringify(JSON.parse(text), null, 2);
                    } catch {
                        pretty = text;
                    }
                    document.getElementById('response').textContent =
                        'Status: ' + res.status + '\n' + pretty;
                })
                .catch(err => {
                    document.getElementById('response').textContent = 'Error: ' + err;
                });
        }
    </script>
</body>

</html>

# ðŸ”’ **Security Best Practices - ChillAjar Backend**

Panduan keamanan untuk deployment dan maintenance aplikasi ChillAjar Backend.

---

## ðŸš¨ **CRITICAL SECURITY RULES**

### âŒ **JANGAN PERNAH:**

1. **Commit Credentials ke Git**
   ```bash
   âŒ SALAH:
   DB_PASSWORD=Manpro2025!  # Hardcoded di code
   JWT_SECRET=my-secret     # Di file yang ter-commit
   
   âœ… BENAR:
   DB_PASSWORD=${DB_PASSWORD}  # Ambil dari environment
   Gunakan file .env (sudah di .gitignore)
   ```

2. **Share Credentials via Public Channel**
   ```
   âŒ SALAH:
   - WhatsApp group
   - Email tanpa encryption
   - Slack public channel
   - GitHub issues/PR comments
   
   âœ… BENAR:
   - Password manager (1Password, Bitwarden)
   - Secure note apps
   - Encrypted messaging
   - Face-to-face / video call
   ```

3. **Use Default Passwords in Production**
   ```
   âŒ SALAH:
   admin@chillajar.com / password123
   root / root
   admin / admin
   
   âœ… BENAR:
   Generate strong passwords:
   - Minimum 12 characters
   - Mix: uppercase, lowercase, numbers, symbols
   - Unique per service
   ```

4. **Enable Debug Mode in Production**
   ```env
   âŒ SALAH:
   APP_DEBUG=true
   APP_ENV=local
   
   âœ… BENAR:
   APP_DEBUG=false
   APP_ENV=production
   ```

5. **Expose Sensitive Files Publicly**
   ```
   âŒ SALAH:
   - .env file accessible via web
   - Database backup in public folder
   - Config files di /public
   
   âœ… BENAR:
   - Check .gitignore properly configured
   - Verify web server config (nginx/apache)
   - Keep sensitive files outside web root
   ```

---

## ðŸ” **Password & Secret Management**

### Generate Secure Passwords

```bash
# APP_KEY (Laravel)
php artisan key:generate --show

# JWT_SECRET
openssl rand -base64 32

# Random Strong Password
openssl rand -base64 16

# Ultra Strong Password (24 chars)
openssl rand -base64 24
```

### Password Requirements (Production)

| Purpose | Min Length | Requirements |
|---------|-----------|--------------|
| Admin User | 12 chars | Upper, lower, number, symbol |
| Database | 16 chars | Upper, lower, number, symbol |
| JWT Secret | 32 chars | Random base64 |
| APP_KEY | Auto | Generated by Laravel |
| API Tokens | 32 chars | Random base64 |

### Password Manager (Recommended)

**Team Solutions:**
- ðŸ”‘ **1Password Teams** - Paid, best for teams
- ðŸ”‘ **Bitwarden** - Open source, affordable
- ðŸ”‘ **LastPass** - Popular, free tier available

**Personal Use:**
- ðŸ”‘ **KeePass** - Free, offline
- ðŸ”‘ **Bitwarden** - Free tier available

---

## ðŸ”’ **Environment Variables Security**

### File Structure

```
Project Root
â”œâ”€â”€ .env                    # Local dev (gitignored)
â”œâ”€â”€ .env.example            # Template (safe to commit)
â”œâ”€â”€ .env.docker             # Docker template (safe to commit)
â””â”€â”€ .env.production         # Production (gitignored)
```

### Environment File (.env) - Best Practices

```env
# âœ… GOOD: Use placeholders in templates
APP_KEY=
DB_PASSWORD=
JWT_SECRET=

# âŒ BAD: Real values in templates
APP_KEY=base64:abc123...
DB_PASSWORD=Manpro2025!
JWT_SECRET=my-secret-key
```

### .gitignore Configuration

Pastikan file ini ada di `.gitignore`:

```gitignore
# Environment files with credentials
.env
.env.local
.env.production
.env.staging
.env.*.local

# Sensitive documentation
/docker/QUICK-REFERENCE.md
**/credentials.md
**/secrets.md
*.credentials
*.secrets

# Backup files
*.backup
*.bak
*.sql
*.dump
```

---

## ðŸ—„ï¸ **Database Security**

### Connection Security

```env
# âœ… GOOD: Strong credentials
DB_USERNAME=chill_prod_user_2024
DB_PASSWORD=Xk9#mP2$vL8@qR4&wN7

# âŒ BAD: Weak/default credentials
DB_USERNAME=root
DB_PASSWORD=root
```

### Access Control

1. **Principle of Least Privilege**
   ```sql
   -- âœ… Create specific user with limited permissions
   CREATE USER 'app_user'@'localhost' 
   IDENTIFIED BY 'strong_password';
   
   GRANT SELECT, INSERT, UPDATE, DELETE 
   ON app_database.* 
   TO 'app_user'@'localhost';
   
   -- âŒ Don't use root for application
   ```

2. **Database Firewall**
   ```yaml
   # docker-compose.yml
   db:
     ports:
       - "127.0.0.1:33061:3306"  # âœ… Only localhost
       # NOT: - "33061:3306"     # âŒ Exposed to public
   ```

3. **Regular Backups**
   ```bash
   # Automated backup script
   mysqldump -u backup_user -p db_name > backup_$(date +%Y%m%d).sql
   
   # Encrypt backup
   gpg --encrypt backup_20250102.sql
   ```

---

## ðŸŒ **API Security**

### Authentication

```php
// âœ… GOOD: Require authentication
Route::middleware('auth:sanctum')->group(function () {
    Route::get('/profile', [ProfileController::class, 'show']);
});

// âŒ BAD: Open endpoints
Route::get('/users', [UserController::class, 'index']);
```

### Rate Limiting

```php
// config/sanctum.php
'middleware' => [
    'throttle:api', // âœ… Enable rate limiting
],

// routes/api.php
Route::middleware(['throttle:60,1'])->group(function () {
    // Max 60 requests per minute
});
```

### Input Validation

```php
// âœ… GOOD: Validate all inputs
$validated = $request->validate([
    'email' => 'required|email|max:255',
    'password' => 'required|min:8|max:255',
]);

// âŒ BAD: Direct database insert
DB::insert('users', $request->all());
```

### CORS Configuration

```php
// config/cors.php
return [
    'paths' => ['api/*'],
    'allowed_origins' => [
        'https://yourdomain.com',  // âœ… Specific domain
        // '*'                     // âŒ Too permissive
    ],
];
```

---

## ðŸ” **JWT Token Security**

### Token Configuration

```env
# âœ… GOOD: Secure settings
JWT_SECRET=base64:very-long-random-string-here
JWT_TTL=60              # 1 hour
JWT_REFRESH_TTL=20160   # 2 weeks

# âŒ BAD: Insecure settings
JWT_SECRET=secret
JWT_TTL=43200           # 30 days (too long)
```

### Token Handling

```javascript
// âœ… GOOD: Store in httpOnly cookie or secure storage
localStorage.setItem('token', token);  // OK for demo
// Better: httpOnly cookie

// âŒ BAD: Token in URL
https://api.example.com/data?token=abc123
```

---

## ðŸ–¥ï¸ **Server Security**

### Firewall Rules

```bash
# âœ… Allow only necessary ports
ufw allow 22/tcp   # SSH
ufw allow 80/tcp   # HTTP
ufw allow 443/tcp  # HTTPS
ufw enable

# âŒ Don't expose database port publicly
# ufw allow 3306/tcp  # MySQL - DON'T DO THIS
```

### VPN Access

```
âœ… REQUIRED for management access:
- Twingate VPN
- Only authorized team members
- Access logs monitored

âŒ DON'T expose Portainer/PHPMyAdmin publicly
```

### Regular Updates

```bash
# Keep system updated
apt update && apt upgrade -y

# Update Docker images
docker-compose pull
docker-compose up -d

# Update Laravel dependencies
composer update
```

---

## ðŸ“ **Code Security**

### SQL Injection Prevention

```php
// âœ… GOOD: Use query builder or Eloquent
User::where('email', $email)->first();
DB::table('users')->where('email', $email)->get();

// âŒ BAD: Raw SQL with user input
DB::select("SELECT * FROM users WHERE email = '$email'");
```

### XSS Prevention

```blade
{{-- âœ… GOOD: Escaped output --}}
{{ $user->name }}

{{-- âŒ BAD: Unescaped output --}}
{!! $user->name !!}
```

### CSRF Protection

```blade
{{-- âœ… GOOD: Include CSRF token --}}
<form method="POST" action="/profile">
    @csrf
    ...
</form>
```

---

## ðŸ” **Monitoring & Logging**

### Log Sensitive Actions

```php
// Log authentication attempts
Log::info('Login attempt', ['email' => $email]);

// Log failed access
Log::warning('Unauthorized access attempt', [
    'ip' => $request->ip(),
    'endpoint' => $request->path(),
]);

// âŒ DON'T log passwords or tokens
Log::info('User data', $request->all());  // BAD if contains password
```

### Monitor Failed Logins

```php
// Implement login throttling
use Illuminate\Support\Facades\RateLimiter;

RateLimiter::hit($email, 300); // 5 minutes lockout
if (RateLimiter::tooManyAttempts($email, 5)) {
    // Block user
}
```

---

## ðŸš¨ **Incident Response**

### If Credentials are Compromised:

1. **Immediate Actions:**
   ```bash
   # 1. Rotate all keys
   php artisan key:generate --force
   
   # 2. Change database password
   # 3. Revoke all JWT tokens
   # 4. Notify team
   ```

2. **Investigation:**
   - Check access logs
   - Review git history
   - Scan for backdoors

3. **Prevention:**
   - Update .gitignore
   - Implement secrets scanning
   - Team security training

### Emergency Contacts

- **Server Admin**: [Contact info in secure location]
- **Backend Lead**: [Contact info in secure location]
- **Security Team**: [If available]

---

## âœ… **Security Checklist**

### Pre-Deployment
- [ ] All credentials generated (not default)
- [ ] .env files properly gitignored
- [ ] APP_DEBUG=false in production
- [ ] Strong passwords (12+ chars)
- [ ] JWT_SECRET generated
- [ ] Database credentials unique and strong

### Post-Deployment
- [ ] Change default admin password
- [ ] Enable rate limiting
- [ ] Configure CORS properly
- [ ] SSL certificate installed
- [ ] Firewall configured
- [ ] VPN access only for management
- [ ] Regular backup schedule
- [ ] Monitoring enabled

### Ongoing
- [ ] Regular security updates
- [ ] Log review (weekly)
- [ ] Backup verification (weekly)
- [ ] Dependency updates (monthly)
- [ ] Security audit (quarterly)
- [ ] Password rotation (as needed)

---

## ðŸ“š **Resources**

### Documentation
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Laravel Security Best Practices](https://laravel.com/docs/security)
- [Docker Security](https://docs.docker.com/engine/security/)

### Tools
- **Static Analysis**: PHPStan, Psalm
- **Dependency Scanning**: Snyk, Dependabot
- **Secrets Scanning**: GitGuardian, TruffleHog

---

**Remember: Security is not a one-time task, it's an ongoing process!**

**Last Updated**: November 2, 2025
